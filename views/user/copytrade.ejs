<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copy Trades - Professional Trading</title>
    <link href="https://cdn.tailwindcss.com" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
</head>

<body class="bg-gray-900 text-white dark:text-white">
    <%- include('./partials/dashboardhead.ejs') %>

        <div class="container mx-auto px-4 py-8 mt-16 md:ml-64 ">
            <!-- Page Header -->
            <div class="md:flex items-center justify-between mb-8 mt-20">
                <div>
                    <h1 class="text-3xl font-bold text-white mb-2">Copy Trading</h1>
                    <p class="text-gray-400">Copy successful trades from our expert traders</p>
                </div>
                <div class="flex items-center space-x-4 justify-between">
                    <span class="text-sm text-gray-400">Available Trades: <%= trades.length %></span>
                    <button onclick="refreshTrades()"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition duration-200">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-gray-800 rounded-lg p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-chart-line text-white"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-400">Active Trades</p>
                            <p class="text-2xl font-bold text-white">
                                <%= trades.filter(t=> t.status === 'active').length %>
                            </p>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-800 rounded-lg p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-yellow-500 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-dollar-sign text-white"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-400">Total Volume</p>
                            <p class="text-2xl font-bold text-white">$<%= trades.reduce((sum, t)=> sum + (t.amount ||
                                    0), 0).toFixed(2) %></p>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-800 rounded-lg p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-trophy text-white"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-400">Success Rate</p>
                            <p class="text-2xl font-bold text-white">92%</p>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-800 rounded-lg p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-users text-white"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-400">Copiers</p>
                            <p class="text-2xl font-bold text-white">1,020,247</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trades Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <% trades.forEach((trade, index)=> { %>
                    <div
                        class="bg-gray-800 rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition duration-300">
                        <!-- Trade Header -->
                        <div class="p-4 border-b border-gray-700">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div
                                        class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center mr-3">
                                        <i class="fas fa-chart-bar text-white"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-white">
                                            <%= trade.marketSelect || trade.pair || 'N/A' %>
                                        </h3>
                                        <p class="text-sm text-gray-400">
                                            <%= trade.tradeType || 'N/A' %>
                                        </p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span
                                        class="px-2 py-1 text-xs rounded-full <%= trade.status === 'active' ? 'bg-green-500' : trade.status === 'closed' ? 'bg-red-500' : 'bg-yellow-500' %> text-white">
                                        <%= trade.tradeTime|| 'N/A' %>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Trade Details -->
                        <div class="p-4">
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-400">Amount:</span>
                                    <span class="text-white font-medium">$<%= (trade.amount || 0).toFixed(2) %></span>
                                </div>

                                <!-- <div class="flex justify-between">
                                    <span class="text-sm text-gray-400">Entry Price:</span>
                                    <span class="text-white font-medium">$<%= (trade.entryPrice || 0).toFixed(4) %>
                                    </span>
                                </div> -->

                                <!-- <div class="flex justify-between">
                                    <span class="text-sm text-gray-400">Current Price:</span>
                                    <span class="text-white font-medium">$<%= (trade.currentPrice || 0).toFixed(4) %>
                                    </span>
                                </div> -->

                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-400">Leverage:</span>
                                    <span class="text-white font-medium">
                                        <%= trade.leverage || 'N/A' %>
                                    </span>
                                </div>

                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-400">Profit/Loss:</span>
                                    <span
                                        class="text-white font-medium <%= (trade.profit || 0) >= 0 ? 'text-green-400' : 'text-red-400' %>">
                                        $<%= (trade.profit || 0 ).toFixed(2) %>
                                    </span>
                                </div>

                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-400">Trader:</span>
                                    <span class="text-white font-medium">Expert Trader</span>
                                </div>

                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-400">Success Rate:</span>
                                    <span class="text-green-400 font-medium">92%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Copy Button -->
                        <div class="p-4 border-t border-gray-700">
                            <button
                                onclick="showSuccessModal()"
                                class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white py-3 px-4 rounded-lg font-semibold transition duration-200 flex items-center justify-center">
                                <i class="fas fa-copy mr-2"></i>Copy Trade
                            </button>
                        </div>
                    </div>
                    <% }) %>
            </div>

            <!-- Empty State -->
            <% if (trades.length===0) { %>
                <div class="flex justify-center items-center h-96">
                    <div class="text-center">
                        <i class="fas fa-chart-bar text-gray-600 text-6xl mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-400 mb-2">No trades available</h3>
                        <p class="text-gray-500">Check back later for new trading opportunities</p>
                    </div>
                </div>
                <% } %>
        </div>

        <%- include('./partials/footer.ejs') %>

            <!-- Success Modal -->
            <div id="successModal"
                class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-gray-800 rounded-lg p-8 max-w-md mx-4 transform transition-all">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-check text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-2">Trade Copied Successfully!</h3>
                        <p class="text-gray-300 mb-6">Your trade has been copied and is now active in your account.</p>
                        <button onclick="closeSuccessModal()"
                            class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition duration-200">
                            Continue Trading
                        </button>
                    </div>
                </div>
            </div>
            <script src="/js/userdashboard.js"></script>

            <script>
                // Copy trade function
                async function copyTrade(tradeId, pair, amount, tradeType, leverage) {
                    try {
                        // Show loading state
                        const button = event.target;
                        const originalText = button.innerHTML;
                        button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Copying...';
                        button.disabled = true;

                        // Simulate API call to copy trade
                        const response = await fetch('/api/user/copy-trade', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                tradeId: tradeId,
                                pair: pair,
                                amount: amount,
                                tradeType: tradeType,
                                leverage: leverage
                            })
                        });

                        const data = await response.json();

                        if (response.ok) {
                            // Show success modal
                            showSuccessModal();
                        } else {
                            alert(data.error || 'Failed to copy trade');
                        }

                        // Reset button
                        button.innerHTML = originalText;
                        button.disabled = false;
                    } catch (error) {
                        console.error('Error copying trade:', error);
                        alert('Network error. Please try again.');

                        // Reset button
                        const button = event.target;
                        button.innerHTML = '<i class="fas fa-copy mr-2"></i>Copy Trade';
                        button.disabled = false;
                    }
                }

                // Show success modal
                function showSuccessModal() {
                    const modal = document.getElementById('successModal');
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                }

                // Close success modal
                function closeSuccessModal() {
                    const modal = document.getElementById('successModal');
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                }

                // Refresh trades
                function refreshTrades() {
                    window.location.reload();
                }

                // Auto-close modal after 3 seconds
                document.getElementById('successModal').addEventListener('click', function (e) {
                    if (e.target === this) {
                        closeSuccessModal();
                    }
                });

                // Add keyboard support
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape') {
                        closeSuccessModal();
                    }
                });
            </script>
</body>

</html>